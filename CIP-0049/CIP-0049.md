---
CIP: 49?
Title: Extended 721 metadata
Authors: Jack (Pixel pool, https://forum.cardano.org/u/jack7e/, @pixel_pool twitter)
Comments-URI: https://forum.cardano.org/t/cip-extended-721/
Status: Draft
Type: Informational
Created: 2022-04-22 (updated 2022-09-22)
---

## Important note

This CIP depends on CIP48

# Abstract

This standard proposes a fully on chain method to store and access metadata.
This would allow users of 721 to increase or reduce the amount of data stored on chain.

# Motivation

- Large token mints that duplicated data could be dramatically reduced in size by pointing to one transaction payload that contains a ‘boilerplate’ structure.

- 16kB is the upper limit of data in each transaction but If a user wanted more there is no alternative than to store that data off-chain using an external service such as ipfs.

- This CIP aims to describe is a standard so that if a user does want to reduce or increase there metadata size it can be queried by 3rd parties that look for the version 2 tag attached within the 721 metadatum transaction label

Specifically, this proposal aims to solve for the following:

- Provide a mechanism to reduce duplicated metadata into one or multiple transactions that can be referenced
- Provide a mechanism that allows on chain data to be referenced
- Provide a mechanism to reference on chain data in a set order
- Provide a mechanism to reference on chain data stored in a different policy

# Specification

**Inside the 721 metadata JSON**
|reserved |description | scope |
|---|---|---|
|r | references tag, defines where to find the onchain data | Inside `<asset_name>` tag |
|p | contains raw data, defines on chain data | Inside `<policy_id>` tag |

**Optional policy tag**

By defualt CIP-48 will assume all payloads can be found within all the mint transcations made by the parent `"<policy_id>"`. A `policy` tag can be defined withing the references tag if the onchain data payload is stored within an external policy.

## General structure

```json
{
   "721":{
      "<policy_id>":{
         "ext":["cip49"] // required
         "<asset_name>":{
            "project":"<string>",
            "name":"<string>",
            // references
            "r":[{
               "name":"<string>",
               "mediaType":"text/plain",
               "src":"<array>" // array of required payload ids
            }]
         },
         // payload
         "p":{
            "<string>":"<array>", // payload 0
            "<string>":"<array>", // payload 1... etc
         },
      }
   }
}
```

# Example

Mint transaction 1

```json
{
   "721":{
      "0000000000000000000000000000000000000000000000000000000A":{
         "ext":["cip49"] // required
         "NFT0":{
            "project":"CIP49 Example",
            "name":"NFT0",
            // references
            "r":[{
               "name":"<string>",
               "mediaType":"text/plain",
               "src":[
                  "0",
                  "2"
               ]
            }]
         },
         // payload
         "p":{
            "0":["Hello"],"1":["Goodbye"]
         },
      }
   }
}
```

Mint transaction 2

```json
{
   "721":{
      "0000000000000000000000000000000000000000000000000000000A":{
         "ext":["cip49"] // required
         "NFT1":{
            "project":"CIP49 Example",
            "name":"NFT1",
            // references
            "r":[{
               "name":"<string>",
               "mediaType":"text/plain",
               "src":[
                  "0",
                  "3"
               ]
            }]
         },
         // payload
         "p":{
            "2":["World"],"3":["Moon"]
         },
      }
   }
}

```

## Example pseudo code walk through

1. Find all transactions for the given policy

`found 2 mint transcations`

2. Check the **ext** tag for **cip49**

`found cip49`

3. If a payload is found append that to an map or some data structure

```js
payloads = { 0: "Hello", 1: "Goodbye", 2: "World", 3: "Moon" };
```

4. Find all refrences for NFT0

```js
nft0_refs = ["0", "2"];
nft0_data = "HelloWorld";
```

# Backwards compatibility

Handled via the use of the `"ext"` tag defined in CIP-48.

# Further considerations

### Duplicate data

There could be issues with duplicate payloads. To solve the payload defined in the most recently minted tx takes priority.
